!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.lsbridge=t()}(this,function(){var n,i,o,u,f,e={};return e.isLSAvailable=function(){try{return localStorage.setItem("_","_"),localStorage.removeItem("_"),!0}catch(e){return!1}}(),e.isLSAvailable?(n=localStorage,o=!(i={}),u={},f=function(){for(var t in i){var e=n.getItem(t);if(e&&u[t]&&-1===u[t].indexOf(e)){u[t].push(e);try{var o=JSON.parse(e);o&&(e=o)}catch(e){}for(var r=0;r<i[t].length;r++)i[t][r](e);n.getItem(t+"-removeit")||(n.setItem(t+"-removeit","1"),function(e){setTimeout(function(){n.removeItem(e),n.removeItem(e+"-removeit"),u[t]=[]},200)}(t))}else e||(u[t]=[])}return setTimeout(f,100),!0},e.send=function(e,t){var o="",o="object"==typeof(t="function"==typeof t?t():t)?JSON.stringify(t):t;n.setItem(e,o)},e.subscribe=function(e,t){i[e]||(i[e]=[],u[e]=[]),i[e].push(t),o=o||f()},e.unsubscribe=function(e){i[e]&&(i[e]=[]),u[e]&&(u[e]=[])},e.getBuffer=function(){return u}):e.send=e.subscribe=function(){throw new Error("localStorage not supported.")},e});